# -*- coding: utf-8 -*-
# Generated by Django 1.9.5 on 2016-06-20 11:13
from __future__ import unicode_literals

from django.db import migrations

from geo_views import migrate


class Migration(migrations.Migration):

    dependencies = [
        ('panoramas', '0007_faster_materialized')
    ]

    operations = [
        migrate.ManageMaterializedView(
            view_name="panoramas_adjacencies",
            sql="""
SELECT row_number() OVER (ORDER BY pp.id, pp1.id) AS id,
  pp.id AS from_pano_id,
  pp1.id AS to_pano_id,
  degrees(st_azimuth(geography(pp.geolocation), geography(pp1.geolocation))) AS heading,
  st_distance(geography(pp.geolocation), geography(pp1.geolocation)) AS distance,
  st_z(pp1.geolocation) - st_z(pp.geolocation) AS elevation
FROM panoramas_panorama pp,
    panoramas_panorama pp1
WHERE st_dwithin(pp.geopoint, pp1.geopoint, 0.00009000009::double precision) AND pp1.id <> pp.id
ORDER BY pp.id, pp1.id"""
        ),
    ]
